<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="Spark apps on YARN">
    <meta property="og:type" content="blog">
  <title>Spark apps on YARN</title>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span>✍</span> <span>Home</span></div>
    </a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              </nav>
  <header class="Header">
          <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <div class="Header__Icon"><span><img class="inline-img-icon" src="https://shrikar.com/wp-content/uploads/2018/10/Apache-Spark-e-Data-Science-.png"></span></div>
        <h1 class="Header__Title">Spark apps on YARN</h1>
            <div class="DateTagBar">
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--pink">
            <a href="tag/Hotstar.html">Hotstar</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--purple">
            <a href="tag/Spark.html">Spark</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/YARN.html">YARN</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/feb6596bc09140aa8ab04a67fbba7bb3" class="PageRoot"><h2 id="https://www.notion.so/ff58135e00264e3bab2800a2084be220" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ff58135e00264e3bab2800a2084be220"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Submit a single app through spark-submit</span></span></h2><div id="https://www.notion.so/33742e61f8bc4de7ae129c82a2231763" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The submitting shell is the Bash-based </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Spark driver</strong></span><span class="SemanticString"> (so needs to be kept alive throughout):</span></span></p></div><pre id="https://www.notion.so/57ba8b906a294399be88f93bc1afd7dc" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>spark-submit --class <span class="token string">"FileCompaction"</span> --master <span class="token function">yarn</span> --queue marketing --executor-memory 3G --conf <span class="token string">"spark.dynamicAllocation.enabled=true"</span> --conf <span class="token string">"spark.storage.memoryFraction=1"</span> --conf <span class="token string">"spark.shuffle.service.enabled=true"</span> --conf <span class="token string">"spark.shuffle.compress=true"</span>  --conf <span class="token string">"spark.default.parallelism=100"</span> --conf <span class="token string">"spark.yarn.driver.memoryOverhead=2048"</span> --conf <span class="token string">"spark.port.maxRetries=25"</span> ./target/scala-2.11/smallfilecompaction_2.11-0.1.jar <span class="token operator">&lt;</span>accessKeyId<span class="token operator">></span> <span class="token operator">&lt;</span>secretAccessKey<span class="token operator">></span> data_lake_name events/simple_event/simple_event_partition/cd<span class="token operator">=</span><span class="token number">2019</span>-05-30</span></span></span></code></pre><div id="https://www.notion.so/255ef5a4b3d24d31b866591b2e8499b3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Or to disown the Spark app from the submitting shell:</span></span></p></div><pre id="https://www.notion.so/32a3f1a609354a17badd9fe67910d8e7" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token function">nohup</span> spark-submit --class <span class="token string">"FileCompaction"</span> --master <span class="token function">yarn</span> --queue marketing --executor-memory 3G --conf <span class="token string">"spark.dynamicAllocation.enabled=true"</span> --conf <span class="token string">"spark.storage.memoryFraction=1"</span> --conf <span class="token string">"spark.shuffle.service.enabled=true"</span> --conf <span class="token string">"spark.shuffle.compress=true"</span>  --conf <span class="token string">"spark.default.parallelism=100"</span> --conf <span class="token string">"spark.yarn.driver.memoryOverhead=2048"</span> --conf <span class="token string">"spark.port.maxRetries=25"</span> ./target/scala-2.11/smallfilecompaction_2.11-0.1.jar <span class="token operator">&lt;</span>accessKeyId<span class="token operator">></span> <span class="token operator">&lt;</span>secretAccessKey<span class="token operator">></span> data_lake_name events/simple_event/simple_event_partition/cd<span class="token operator">=</span><span class="token number">2019</span>-05-30 <span class="token operator">&amp;</span></span></span></span></code></pre><div id="https://www.notion.so/7ddd68e0abe94bcb93ec551d472b4fcf" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The difference is as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">nohup &lt;command&gt; &amp;</code></span></span></p></div><h2 id="https://www.notion.so/b89532066812469eb1fe699cc883e6df" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/b89532066812469eb1fe699cc883e6df"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Spark-shell</span></span></h2><div id="https://www.notion.so/31d9d4c40cb84f1d954e2d36ee77e5bb" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Spark shell is quite a good way to carry out ad-hoc experiments with a Spark app or even before writing it. To launch a Spark shell correctly, following are the guidelines:</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/fc62ac8e46504b1aaa5ac75fa02ff52e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Ensure the Spark version on your local/cluster and accordingly pass </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">SPARK_MAJOR_VERSION</code></span><span class="SemanticString"> env variable (say 2)</span></span></li><li id="https://www.notion.so/4c0db32a049d49e79f24c951e2dea632" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">There are multiple ways to include external libraries (packages or JARs) into the Spark shell just while experimenting. While it is a bad idea to always global install the package on a local machine, it is always advisable the following:</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/7e3d14bf941241d1b5f01c518bee50b0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">packages</strong></span><span class="SemanticString"> can be passed with as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">—packages &lt;groupId:artifactId:version&gt;</code></span><span class="SemanticString">. This is the most recommended way to fetch packages on the go.</span></span></li><li id="https://www.notion.so/3abc641383fa4570bbe0162e91e1885a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">JARs</strong></span><span class="SemanticString"> can be passed as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">—jars &lt;abc.jar&gt;</code></span><span class="SemanticString">. This is a also very convenient way of testing.</span></span></li></ul></li></ul><h1 id="https://www.notion.so/68bc96866da4404cb55c63bab9a4c827" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/68bc96866da4404cb55c63bab9a4c827"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Cluster</span></span></h1><div id="https://www.notion.so/f2351bf383e7419c9e3ee7e9b446f988" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">We are running the apps on a YARN Hadoop Cluster. It is responsible for managing the app executions. Also, there are partitioned into various </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">queues</strong></span><span class="SemanticString"> which are responsible for segregated resources and better management.</span></span></p></div><div id="https://www.notion.so/21f1de9634294cd5a5dd816736c7ec3a" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">💡</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">Our DEV environment cluster has about </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">256GB</strong></span><span class="SemanticString"> memory, </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">16</strong></span><span class="SemanticString"> nodes, </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">52</strong></span><span class="SemanticString"> containers. In the PROD environment there is about </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">13.5TB</strong></span><span class="SemanticString"> memory.</span></span></p></div><h1 id="https://www.notion.so/cfcfddb48edf490e97866c20a30b8ca2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/cfcfddb48edf490e97866c20a30b8ca2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Nodes</span></span></h1><div id="https://www.notion.so/c17fbabf8c7f47d48ac855be51129053" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Nodes are the boxes or machines as you all it. For example </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">1 EC2 machine</strong></span><span class="SemanticString"> on AWS →  </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">1 Node</strong></span><span class="SemanticString">. A node will have a single OS.</span></span></p></div><h1 id="https://www.notion.so/e52d047af8914a5bb49ec30f548a3d10" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/e52d047af8914a5bb49ec30f548a3d10"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Containers</span></span></h1><div id="https://www.notion.so/9a1d3088493d4b4382c85046e3699b22" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Containers are the abstractions of singular machines over a node. That is, it could be a </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">Docker</em></span><span class="SemanticString"> container or equivalent. Developers write Docker </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">images</strong></span><span class="SemanticString"> → Docker is responsible for spawning up these images into </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">containers</strong></span><span class="SemanticString">  (or </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">instances</strong></span><span class="SemanticString">).</span></span></p></div><h1 id="https://www.notion.so/e41759960d794035b41e23b6b4d0ea5e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/e41759960d794035b41e23b6b4d0ea5e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Executors</span></span></h1><div id="https://www.notion.so/6823558d170d4803b74a67edd9e37c3e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Executors are </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">task-runners</strong></span><span class="SemanticString">. They can run many tasks </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">multithreaded</em></span><span class="SemanticString">-ly. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Executor memory</strong></span><span class="SemanticString">, </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">number of cores per executor</strong></span><span class="SemanticString"> can be specified in the Spark job configuration, and these are the most important factors governing the performance of a Spark job.</span></span></p></div><h1 id="https://www.notion.so/615a1fdec95442c394290a4baccd1704" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/615a1fdec95442c394290a4baccd1704"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Tasks</span></span></h1><div id="https://www.notion.so/feb86c7537f648ddb1daee18aef0e1aa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Tasks are the most fundamental unit of work - i.e. could be a </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">mapper</strong></span><span class="SemanticString"> or a </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">reducer</strong></span><span class="SemanticString">. Spark configuration allows the reducer tasks to be started once the mapper tasks have finished.</span></span></p></div><div id="https://www.notion.so/814c3a8a553b4d10b4fa262e3980b36b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><div id="https://www.notion.so/8d5a1f223ef140fd9e35d16f195e5483" class="CollectionInline"><h3><a class="Anchor" href="#https://www.notion.so/8d5a1f223ef140fd9e35d16f195e5483"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">spark-submit configurations</span></span></h3><div class="Table"><table><thead><tr><th style="width:309px">config</th><th style="width:399px">Explanation</th><th>Syntax</th></tr></thead><tbody><tr><td class="Table__CellTitle"><a href="https://www.notion.so/f56acc61d65f477bbaeab5ba839ee058"><span class="SemanticStringArray"><span class="SemanticString">executor-memory</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">specified as </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">xG</code></span><span class="SemanticString"> where x is in GB. This is the amount of memory provided per executor.</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">—executor-memory &lt;value&gt;</code></span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/a1ca570a777845d78f7fa7682f049398"><span class="SemanticStringArray"><span class="SemanticString">executor-cores</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">specified as a number; this decides the number of cores per executor. Needs to be decided wisely based on the number of cores availed by the node. </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://site.clairvoyantsoft.com/understanding-resource-allocation-configurations-spark-application/"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">5</strong></a></span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="http://site.clairvoyantsoft.com/understanding-resource-allocation-configurations-spark-application/"> is the optimal number, much more won&#x27;t help</a></span><span class="SemanticString">.</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--executor-cores 1</code></span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/b8e24837eb1a49449aa5e34a15853b03"><span class="SemanticStringArray"><span class="SemanticString">spark.dynamicAllocation.enabled</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">can be </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">true</code></span><span class="SemanticString"> or </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">false</code></span><span class="SemanticString">; if enabled, tells YARN to give more executor memory to heavier applications i.e. attempts to utilise the maximum resources in the particular queue. Can be dangerous to be enabled on PROD env.</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--conf &quot;spark.dynamicAllocation.enabled=&lt;value&gt;&quot;</code></span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/dd753b055d87424888a5144056dd4f0f"><span class="SemanticStringArray"><span class="SemanticString">spark.dynamicAllocation.minExecutors</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">specified as a number; this decides upon the minimum number of executors to be started with - ideally should be well-calculated in busy queues to prevent app getting into PENDING state. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Default value is 0.</strong></span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">--conf &quot;spark.dynamicAllocation.minExecutors=&lt;val&gt;&quot;</code></span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/ae9d9a06a1604a62a10af9ebb9f3e469"><span class="SemanticStringArray"><span class="SemanticString">spark.dynamicAllocation.maxExecutors</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">specified as a number; this decides upon the maximum number of executors that can be assigned to an app; this could potentially block the queue if set too high. </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Default values is INF.</strong></span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">—conf &quot;spark.dynamicAllocation.maxExecutors=&lt;val&gt;&quot;</code></span></span></td></tr><tr><td class="Table__CellTitle"><a href="https://www.notion.so/837a05ab415649828eb622691773e7c0"><span class="SemanticStringArray"><span class="SemanticString">spark.dynamicAllocation.initialExecutors</span></span></a></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString">specified as a number; determines the initial number of executors to be assigned to an app.</span></span></td><td class="Table__CellText"><span class="SemanticStringArray"><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">—conf &quot;spark.dynamicAllocation.initialExecutors=&lt;val&gt;&quot;</code></span></span></td></tr></tbody></table></div></div><div id="https://www.notion.so/e0f9f3cf5a18444fa6202f2bb40a431a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Thus, remember that </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">executor-memory</code></span><span class="SemanticString"> x </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">initialExecutors</code></span><span class="SemanticString"> = total memory consumed by that Spark app.</span></span></p></div><h1 id="https://www.notion.so/ef8d523e7e194cb485fdfdffd2ef7e3e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/ef8d523e7e194cb485fdfdffd2ef7e3e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Debugging certain errors</span></span></h1><ul class="BulletedListWrapper"><li id="https://www.notion.so/d83b65ac5b8042b28e0f183bdebef4fa" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Often the app might succeed but it doesn&#x27;t do the intended job because the driver ran out of memory</strong></span></span><div id="https://www.notion.so/3f40527e2be0434981f4c5c454558ed4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To debug this, we need to configure the driver memory. Driver is the client which is responsible for submitting the job, therefore scanning a huge amount of data might lead to the driver running out of memory. We might need to increase the driver memory in this case by passing the following flag with the spark-submit command:</span></span></p></div><pre id="https://www.notion.so/dc55c7bff880408b93f9336b517c05a2" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>--driver-memory 4G</span></span></span></code></pre></li><li id="https://www.notion.so/a0ce0ee80de84df7ab3b66cfa1f1e9e5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">The Spark job retries twice by default before failing over. This is sometimes not needed</strong></span></span><div id="https://www.notion.so/df25dc1f4caf4c33bb60e066f0a14976" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">This refers to the number of attempts the Spark job makes before failing. This is a good fault tolerance strategy however in case of debugging, we might want to set the maximum number of attempts to 1.</span></span></p></div><pre id="https://www.notion.so/487374c5266347f8bcd0c9146d958326" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>--conf spark.yarn.maxAppAttempts=1</span></span></span></code></pre></li><li id="https://www.notion.so/bd44917e351c4e05bd8e202fdaa80661" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">There is a particular bug in YARN which doesn&#x27;t allow a string to passed as argument which contains </strong></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">&quot;}}&quot;</strong></code></span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">, this could be problematic at times</strong></span></span><div id="https://www.notion.so/0ce97f8739734773ab226c863bcad2ea" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">This is a known bug and we must find workarounds. Including a space between the curly braces might help, but in that case, we must well handle the space on the driver class.</span></span></p></div></li><li id="https://www.notion.so/6fd8a2c94b944c4cbb9f0560ffd3f7ac" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Understanding </strong></span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">spark.memory.fraction</strong></code></span></span><div id="https://www.notion.so/50b6ce3033aa4c0faf0f6438df219a92" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">This configuration allows to balance between how much memory needs to be given to the </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Storage Memory</strong></span><span class="SemanticString"> + </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Execution Memory</strong></span><span class="SemanticString">.  This is the total Heap Memory that will be available to the Spark application. The following figure depicts this:</span></span></p></div><div id="https://www.notion.so/f3bc38f0c90f4e07adbf2a6626c2c994" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5df7a11b-d3a2-430b-bc46-4d336c2045e5%2FUntitled.png?width=432"><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F5df7a11b-d3a2-430b-bc46-4d336c2045e5%2FUntitled.png?width=432" style="width:432px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/c84295c505a84fbb96fc48a2973bf794" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Storage Memory</strong></span><span class="SemanticString"> → Used to store RDD cache data, broadcast variable, unroll data.</span></span></p></div><div id="https://www.notion.so/b1344bcb440a4c48bd6c6efbae9697f2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Execution Memory</strong></span><span class="SemanticString"> → Used to store all the temporary data like in Shuffle, Sort, Join, Aggregation operations</span></span></p></div><div id="https://www.notion.so/37b090b615a7479ab22cf0dfecd8d6ab" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">User Memory</strong></span><span class="SemanticString"> → Used to store data for RDD conversion operations, </span></span></p></div></li></ul></article>  <footer class="Footer">
        <div>&copy; Rounak's Blog 2019</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>