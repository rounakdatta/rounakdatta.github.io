<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Chrome, Firefox OS and Opera Status Bar Color -->
  <meta name="theme-color" content="#FFFFFF">
  <meta property="og:title" content="GoDFS - a simple Distributed FileSystem">
    <meta name="description" content="My first implementation of a distributed system from scratch">
  <meta property="og:description" content="My first implementation of a distributed system from scratch">
    <meta property="og:type" content="blog">
  <title>GoDFS - a simple Distributed FileSystem</title>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
  <link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
  <link rel="stylesheet" type="text/css" href="css/notablog.css">
  <link rel="stylesheet" type="text/css" href="css/theme.css">
  <style>
    :root {
      font-size: 18px;
    }

    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
    <a href="index.html">
      <div class="Navbar__Btn"><span><img class="inline-img-icon" src="https://i.imgur.com/lKXYUKS.png"></span> <span>Home</span></div>
    </a>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span class="Navbar__Delim">&centerdot;</span>
    <a href="about.html">
      <div class="Navbar__Btn"><span>👤</span> <span>About</span></div>
    </a>
          </nav>
  <header class="Header">
          <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
        <div class="Header__Icon"><span><img class="inline-img-icon" src="https://i.imgur.com/vHyMAbl.png"></span></div>
        <h1 class="Header__Title">GoDFS - a simple Distributed FileSystem</h1>
            <div class="DateTagBar">
                <span class="DateTagBar__Item DateTagBar__Date">Posted on Sun, Aug 9, 2020</span>
                          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/Distributed Systems.html">Distributed Systems</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/Hadoop.html">Hadoop</a>
          </span>
                <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/Golang.html">Golang</a>
          </span>
                  </div>
          </header>
      <article id="https://www.notion.so/052e84e5922843758b3f87ca87e41a37" class="PageRoot"><blockquote id="https://www.notion.so/978c4a25e10c4cf5a990d2168a784804" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">Redundancy is the key in software engineering ~Paul Klint</span></span></blockquote><div id="https://www.notion.so/7847d69df01b4b01b8c923a41d637b6a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">I&#x27;ve been midway through </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.goodreads.com/book/show/23463279-designing-data-intensive-applications">Designing Data-Intensive Applications</a></span><span class="SemanticString"> and implementing such a distributed system had always been on my stack. This implementation tries to cover most of the important aspects, yet largely simplified.</span></span></p></div><div id="https://www.notion.so/9e9960d6336e4d5baebb8ee62388121d" class="Bookmark"><a href="https://github.com/rounakdatta/GoDFS"><h5 class="Bookmark__Title">rounakdatta/GoDFS</h5><p class="Bookmark__Desc">Very Simple Distributed FileSystem implementation on the lines of GFS and HDFS The NameNode is the master and is the single point of contact (and failure!) for coordinating all operations. It provides the clients with all the required metadata for accessing the DataNodes.</p><p class="Bookmark__Link">https://github.com/rounakdatta/GoDFS</p></a></div><h1 id="https://www.notion.so/3af754e298504f6e8dd87d49ad730ae3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/3af754e298504f6e8dd87d49ad730ae3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Building Go Distributed File System</span></span></h1><h2 id="https://www.notion.so/7d1a40c76cf34f639178e3412a63c8f5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7d1a40c76cf34f639178e3412a63c8f5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Abstracting away the odds</span></span></h2><div id="https://www.notion.so/26d43d41e6bf42ca970a9453747f4d48" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Proven systems like </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://static.googleusercontent.com/media/research.google.com/en//archive/gfs-sosp2003.pdf">Google FileSystem (GFS)</a></span><span class="SemanticString"> and </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://hadoop.apache.org/docs/r1.2.1/hdfs_design.pdf">Hadoop Distributed FileSystem (HDFS)</a></span><span class="SemanticString"> have almost made developers take distributed architectures for granted. We now regularly use open-source systems like the Hadoop ecosystem tools, managed cloud services without worrying of the underlying engineering behind scaling it across machines, data-centers and continents. In this implementation as well, we have abstracted the working of RPC, filesystem storage considerations, thus making it not production-ready 😉.</span></span></p></div><div id="https://www.notion.so/42f15058b47a47348e397a33f64dc15e" class="Image Image--PageWidth"><figure><a href="https://i.imgur.com/JtwVjvU.png"><img src="https://i.imgur.com/JtwVjvU.png" style="width:100%"/></a><figcaption><span class="SemanticStringArray"><span class="SemanticString">Source: </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://www.jeremydaly.com/takeaways-from-dynamodb-deep-dive-advanced-design-patterns-dat403/">https://www.jeremydaly.com/takeaways-from-dynamodb-deep-dive-advanced-design-patterns-dat403/</a></span></span></figcaption></figure></div><h2 id="https://www.notion.so/0fdd9afe69df403692020527d78c8e1c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/0fdd9afe69df403692020527d78c8e1c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">The pieces</span></span></h2><div id="https://www.notion.so/116e8a14368448f1949343ca46be8108" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">To build a distributed system which stores and serves files on-demand typically needs to have a set of persistent data stores, a coordinating unit and an user-facing dumb client.</span></span></p></div><h3 id="https://www.notion.so/193b9b4b5d6d458daa54583f37afdd34" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/193b9b4b5d6d458daa54583f37afdd34"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">DataNode</span></span></h3><div id="https://www.notion.so/4e51c5fcbf54473b98d2af90a8d56879" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">DataNodes in this system are </span><span class="SemanticString"><em class="SemanticString__Fragment SemanticString__Fragment--Italic">just</em></span><span class="SemanticString"> holding the data and when provided with an address can write data to or read data from that address. The data nodes deal with chunks of data which when aggregated by someone else makes sense. Ideally, the number of data nodes should be greater than one for it to be a distributed system. Also it is not necessary that a single data node would contain every chunk of a particular file.</span></span></p></div><h3 id="https://www.notion.so/4be0db9048b24ded9b2f601482d1a90a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/4be0db9048b24ded9b2f601482d1a90a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">NameNode</span></span></h3><div id="https://www.notion.so/6aef51ade5b94b65af921bb8885e5e23" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">The NameNode is ideally a singular central coordinating unit of the entire system. It&#x27;s responsibilities start from record-keeping of which all data nodes are available/healthy and helping the client decide with where all to put the chunks for an incoming file &amp; where all to fetch the chunks from for a requested file. The name node also knows what is the chunk size (termed BlockSize later) and how many copies of data to keep (ReplicationFactor). The name node is the know-it-all guy of the system and therefore making it&#x27;s death fatal for the system. Therefore we must have a backup name node (called Secondary NameNode) to which the NameNode is flushing all its meta periodically.</span></span></p></div><h3 id="https://www.notion.so/eb136fedf83342349513bc4ad8bebd1c" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/eb136fedf83342349513bc4ad8bebd1c"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Client</span></span></h3><div id="https://www.notion.so/f6ae6afa3c5b49769531d090b4f747ec" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Client does all the talking. Upon the client getting a request from the user interface, it&#x27;s job is to first contact the NameNode for all the meta information. If it is a file </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">PUT</code></span><span class="SemanticString"> request, name node helps it by providing where all to keep the chunks in (the endpoints of the DataNodes and the target directory path within them). If it is a file </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">GET</code></span><span class="SemanticString"> request, the name node helps it by providing the intrinsic details of where exactly to obtain the chunks from. And thus the loop completes.</span></span></p></div><h2 id="https://www.notion.so/41a136407fe04521a0a81bc279d6d3f5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/41a136407fe04521a0a81bc279d6d3f5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">The chunks</span></span></h2><div id="https://www.notion.so/ff88d6124e414da3992c72050e69654f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">We must decide on a BlockSize factor which determines into how many pieces a file is broken into. Of course having this metric too high or low impacts the write and read performances of the system overall, but we need to find a justified value which has been benchmarked. The chunks (henceforth referred to as blocks) are stored as individual files and is indexed by the NameNode through a BlockId. Depending upon ReplicationFactor we might have redundant copies of the same block stored on multiple data nodes.</span></span></p></div><h2 id="https://www.notion.so/3e1fc7ec1d4f4061a623f9f12ea6c0dc" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/3e1fc7ec1d4f4061a623f9f12ea6c0dc"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">The replication</span></span></h2><div id="https://www.notion.so/eaf9696dafa64fd7a4d6a22bafbb942d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Replication is probably the most important factor in this context. We must decide upon the ReplicationFactor considering the cost-reliability trade-off. The replication in this system works as: When the client requests a particular DataNode to write a new block into its file system, the client also supplies with which all data nodes to replicate to. Now as the first data node finishes writing to its own file system, it itself connects to the next replication candidate data node and passes the remaining array of replication candidates. And thus the replication process finishes when the tail of the recursion returns to the client and the replicated file write can be concluded to have succeeded.</span></span></p></div><h2 id="https://www.notion.so/6476ddb4e01d4362a027266fa4d0ba38" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6476ddb4e01d4362a027266fa4d0ba38"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">The talking</span></span></h2><div id="https://www.notion.so/590476939ef04634839c9f164e2d2f46" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">As the client communicates with the NameNode, DataNodes, as the DataNodes whisper to each other, what is the protocol of talking? We are using plain and simple RPC (Remote Procedural Calls) here in this case.</span></span></p></div><h1 id="https://www.notion.so/38159fd358c04e55be26907665f754ec" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/38159fd358c04e55be26907665f754ec"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Setting it up</span></span></h1><div id="https://www.notion.so/26edf7dbd4ff49b4871b118792208846" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">You can try GoDFS manually or by setting it up through Docker Compose. We can test and compile it to produce a binary as:</span></span></p></div><pre id="https://www.notion.so/ab08d859a3904dcaadd2ddffd7320f31" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token function">make</span> <span class="token builtin class-name">test</span>
<span class="token function">make</span> build</span></span></span></code></pre><h2 id="https://www.notion.so/51ea4e8b391a43a0b1538d119edc1e71" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/51ea4e8b391a43a0b1538d119edc1e71"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Natively on local host</span></span></h2><div id="https://www.notion.so/420ffec0a53a4913a98bf664b6c62ce8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">First, we need to set up the DataNode and NameNode daemons, we are starting 3 data nodes for example, and they are running on the same host:</span></span></p></div><pre id="https://www.notion.so/118a72416f174e46bac9d15b59f113f0" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>./godfs datanode --port <span class="token number">7000</span> --data-location .dndata1/
./godfs datanode --port <span class="token number">7001</span> --data-location .dndata2/
./godfs datanode --port <span class="token number">7002</span> --data-location .dndata3/</span></span></span></code></pre><div id="https://www.notion.so/6191d294e7c74fd4a53b25de1272ed80" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Next, we are initializing the NameNode providing it with the list of data nodes available. If not provided explicitly, the NameNode tries discovering services in the local host for a particular range of ports.</span></span></p></div><pre id="https://www.notion.so/ba76c5af34304ac38bfa5aff5fe3706a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>./godfs namenode --datanodes localhost:7000,localhost:7001,localhost:7002 --block-size <span class="token number">10</span> --replication-factor <span class="token number">2</span></span></span></span></code></pre><div id="https://www.notion.so/5dff113f03984a25a5ffb279d7aae522" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Now, we are good to try using the client to do the file keeping and fetching operations (let&#x27;s try with the readme file):</span></span></p></div><pre id="https://www.notion.so/404573f5e8a240959f3f402f777346aa" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>./godfs client --namenode localhost:9000 --operation put --source-path ./ --filename README.md
<span class="token comment"># 2020/08/08 18:08:51 NameNode to connect to is localhost:9000</span>
<span class="token comment"># 2020/08/08 18:08:52 Put status: true</span>

./godfs client --namenode localhost:9000 --operation get --filename README.md
<span class="token comment"># 2020/08/08 18:09:00 NameNode to connect to is localhost:9000</span>
<span class="token comment"># 2020/08/08 18:09:00 Get status: true</span>
<span class="token comment"># FILE CONTENTS ...</span></span></span></span></code></pre><h2 id="https://www.notion.so/6950a0462ef44958a0c17ac93b74f5c5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/6950a0462ef44958a0c17ac93b74f5c5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Containerized through Docker Compose</span></span></h2><div id="https://www.notion.so/078d26bc67674587be0da368c1ed1ea7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">In the </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">docker-compose.yml</code></span><span class="SemanticString"> file, we try to define the DataNode and NameNode as independent services and the requested number of instances of the same will be spawned up. We have individual </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Dockerfile</code></span><span class="SemanticString">s for the DataNode and NameNode.</span></span></p></div><div id="https://www.notion.so/dc4466acaf7447349f282d818ec20725" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Assuming we have Docker set up in the host system, we have to build the images first:</span></span></p></div><pre id="https://www.notion.so/5a370b8ae4e74d5fbd0327a1cc88372f" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker build -t datanode -f daemon/datanode/Dockerfile <span class="token builtin class-name">.</span>
docker build -t namenode -f daemon/namenode/Dockerfile <span class="token builtin class-name">.</span>
docker build -t client -f daemon/client/Dockerfile <span class="token builtin class-name">.</span></span></span></span></code></pre><div id="https://www.notion.so/42efa38342b74f739ef08ff581934fbd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Now we can initiate a desired number of containers for DataNode and a single container for NameNode as:</span></span></p></div><pre id="https://www.notion.so/721dee6871ba4ef6bdc3ee9cedabc0c2" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker-compose up --scale <span class="token assign-left variable">datanode</span><span class="token operator">=</span><span class="token number">6</span> --remove-orphans --force-recreate</span></span></span></code></pre><div id="https://www.notion.so/2bb2386fce4743a7a0a6f8404fa99405" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Next, we would need a client in the same network to test out requests:</span></span></p></div><pre id="https://www.notion.so/fb9cc0d857504d878305d3198546862a" class="Code Code--NoWrap"><code><span class="SemanticStringArray"><span class="SemanticString"><span>docker run -it --network <span class="token function">host</span> client</span></span></span></code></pre><div id="https://www.notion.so/d9faa2330c2c4849a8a00d3189877cbd" class="ColorfulBlock ColorfulBlock--BgGray Callout"><div class="Callout__Icon"><div class="Icon">ℹ️</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">Here we have allowed the DataNode containers to run within the </span><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">host</strong></span><span class="SemanticString"> network, i.e. its processes are now exposed to the host. We need some more sophistication in the isolation here.</span></span></p></div><div id="https://www.notion.so/b99c89040bcc44a3a8afcfc3be43e6be" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Either way of testing, to test the end-to-end working of the system, we not only want </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">GET</code></span><span class="SemanticString"> success, but also want to understand when such a DFS can fail. We can fetch the metadata from the NameNode on where all the blocks of a given file are kept. So, theoretically, if </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">replication-factor</code></span><span class="SemanticString"> is 2 and we identify those 2 DataNodes for a particular file BlockId, we can then experiment with the edge cases of distributed systems by killing those two containers. And then we should no longer be able to fetch the complete file (since a part of it does not exist in any of the data nodes). If practice matches the above theory, we are good to go! 😄</span></span></p></div></article>  <footer class="Footer">
        <div>&copy; Rounak's μBlog 2019</div>
        <div>&centerdot;</div>
        <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
            rel="noopener noreferrer">Notablog</a>.
        </div>
    </footer>
</body>

</html>