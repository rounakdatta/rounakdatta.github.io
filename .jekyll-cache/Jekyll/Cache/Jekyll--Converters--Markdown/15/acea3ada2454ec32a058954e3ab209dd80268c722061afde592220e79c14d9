I"È<p>This is an assignment for the application to <strong>QuillHash</strong> for their Blockchain Developer Internship for summer 2018.</p>

<h4 id="local-usage">Local usage</h4>

<p><code class="highlighter-rouge">git clone https://github.com/rounakdatta/eth-lottery.git</code></p>

<p><code class="highlighter-rouge">testrpc</code> (on a separate terminal)</p>

<p><code class="highlighter-rouge">truffle compile</code></p>

<p><code class="highlighter-rouge">truffle migrate</code></p>

<h4 id="on-remix-ide">On <a href="https://remix.ethereum.org/">Remix IDE</a></h4>

<h3 id="smart-contract">Smart Contract</h3>

<ul>
  <li><code class="highlighter-rouge">Lottery()</code> constuctor accepts the winning number from the Owner and stores it as SHA3 hash (used in Solidity as <code class="highlighter-rouge">keccak256(payload)</code>).</li>
  <li><code class="highlighter-rouge">requestToken()</code> can be called by participants of the lottery to request any amount of tokens (total 1000000 tokens available). Here, 1 token costs 1 ether and in case of fractional payment, the excess is refunded.</li>
  <li><code class="highlighter-rouge">makeGuess()</code> can be called by participants to guess a number and spend a token. Thereâ€™s the security of refund in case the number is out of range.</li>
  <li><code class="highlighter-rouge">closeGame()</code> can be called by the Owner to stop the lottery and find out the winner by matching the hash.</li>
  <li><code class="highlighter-rouge">winnerAddress()</code> will fetch the address of the winning user.</li>
  <li><code class="highlighter-rouge">getPrice()</code> can be called by the winner to receive 50% of the total ether in the contract in his / her account and transferring the remaining 50% to the Owner address.</li>
  <li><b>No winner</b> : The entire amount of ethers present in the smart contract is transferred to the Owner.</li>
</ul>

<h3 id="issues">Issues</h3>

<ul>
  <li>In case multiple users guess the winning number, the last one to guess will be declared the winner.</li>
  <li>The user wonâ€™t be able to request tokens once the 1000000 tokens are exhausted.</li>
</ul>

<p>Find the GitHub repo <a href="https://github.com/rounakdatta/eth-lottery">here</a>.</p>

<p><br /></p>
<center>
<button id="likeButton" onclick="likeItem()"><img src="https://cdn3.iconfinder.com/data/icons/jolly-icons-free/64/thumb-up_64.png" /></button>
<div id="likeCount"></div>
</center>

<script type="text/javascript">

let postTitle = "eth-lottery"

let myLocation = "";

function getLocationDetails() {
$.get("https://json.geoiplookup.io/", function (response) {
    myLocation = response;
});
}

function likeItem() {
  getLocationDetails();

  setTimeout(function(){

  var xhr = new XMLHttpRequest();
  xhr.withCredentials = false;
  
  xhr.addEventListener("readystatechange", function () {
    if (this.readyState === 4) {
      console.log(this.responseText);
      showLikes();
    }
  });
  
  xhr.open("POST", "https://rounakdatta.pythonanywhere.com/like/post/" + postTitle);
  xhr.setRequestHeader("content-type", "application/json");
  xhr.setRequestHeader('Access-Control-Allow-Origin', '*')
  xhr.setRequestHeader("Access-Control-Allow-Credentials", true);
  xhr.setRequestHeader("cache-control", "no-cache");
  xhr.setRequestHeader("postman-token", "6b90fa48-bca5-8464-df36-a229e6b15f2a");
  
  console.log(JSON.stringify(myLocation));
  xhr.send(JSON.stringify(myLocation));

  }, 1000);
}

function showLikes() {

	var data = null;
	
	var xhr = new XMLHttpRequest();
	xhr.withCredentials = false;
	
	xhr.addEventListener("readystatechange", function () {
	  if (this.readyState === 4) {
	    console.log(this.responseText);
	    //alert(this.responseText);
	    document.getElementById('likeCount').innerHTML = "<h4>" + String(this.responseText) + "</h4>";
	  }
	});
	
	xhr.open("GET", "https://rounakdatta.pythonanywhere.com/like/post/" + postTitle);
	xhr.setRequestHeader("cache-control", "no-cache");
	xhr.setRequestHeader('Access-Control-Allow-Origin', '*')
	xhr.setRequestHeader("Access-Control-Allow-Credentials", true);
	xhr.setRequestHeader("postman-token", "5e82f0d5-65e0-a89a-729b-10c6f90fffb9");
	
	xhr.send(data);

}

</script>

<script>
$( document ).ready(function() {
    showLikes();
});
</script>

:ET